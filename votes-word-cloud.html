<!DOCTYPE html>
<meta charset="utf-8">

<body>

<script src="libs/d3.v3.min.js"></script>
<script src="libs/d3.layout.cloud.js"></script>
<script src="libs/jquery.1.11.min.js"></script>
<script>
  var fill = d3.scale.category20();

  var wordsStr = "";
  var words = {};

  d3.json("data-test/sunlight-votes-2014.json", function(data) {
      $.each(data.results, function(j, vote){
        wordsStr += vote.question;  
    })

    words = countWords(wordsStr); 

console.log(words.slice(0,10))

    d3.layout.cloud().size([300, 300])
      .words(words.slice(0,10))
      .rotate(0)
      .font("arial")
      .fontSize(function(d) { return d.size * 8; })
      .on("end", draw)
      .start();

  });

  function countWords (d) {
    var wordsStr = d; 
    var ignore = ['and','the','to','a','of','for','as','i','with','it','is','on','that','this','can','in','be','has','if', '--', 'act', 'or', 'table', 'other', 'res', 'passage', 'bill', 'amend', 'agreeing', 'any', 'by', 'motion', 'law', 'use', 'amdt', 'xviii', 'improve', 'instructions','consideration', 'sgr', 'question','recommit','agreement','observe','repeal','conditioning','resolution','ordering','title','houseon','executive','nomination','right','rights','execution','secretaries', 'needs','rate','congressional','states', 'pn', 'enactments', 'previous', 'block', 'provider', 'providing','amendment','purposeson'];
 
    wordsArray = wordsStr.toLowerCase().replace(/[^a-z\-]/g," ").split(" "); //remove non characters, split by empty space 
    counts={}
    for( i in wordsArray) {
      if(wordsArray[i].length > 1 && $.inArray(wordsArray[i], ignore) < 0) 
        counts[wordsArray[i]] ? counts[wordsArray[i]]+=1 : counts[wordsArray[i]]=1;
    }
    var words = [];
    for (var i in counts) { words.push({"text": i, "size": counts[i]})}
    words.sort(function(a, b) {return b.size - a.size})
    console.log(words)
    return words;
  }

  function draw(words) {
    d3.select("body").append("svg")
        .attr("width", 300)
        .attr("height", 300)
      .append("g")
        .attr("transform", "translate(150,150)")
      .selectAll("text")
        .data(words)
      .enter().append("text")
        .style("font-size", function(d) { return d.size + "px"; })
        .style("font-family", "arial")
        .style("fill", function(d, i) { return fill(i); })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; });
  }
</script>
</body>
</html>

